# Cursor Rules for Local Life Assistant Project

## ⚠️ 代码质量原则 (最高优先级)

### 代码简洁性
- **杜绝重复代码**：发现重复逻辑立即重构，删除冗余代码
- **文件大小控制**：单个文件不超过 500 行，超过则拆分
- **函数职责单一**：每个函数只做一件事，保持简短清晰
- **删除死代码**：未使用的变量、函数、导入及时清理

### 代码质量标准
- **命名规范**：变量、函数使用有意义的英文命名
- **错误处理**：所有异步操作必须有 try-catch 或适当错误处理
- **类型安全**：TypeScript 项目必须使用严格类型，避免 any
- **注释精简**：只在复杂逻辑处添加必要注释，避免废话

### 开发效率
- **避免过度抽象**：除非必要，不要过度设计架构
- **保持一致性**：代码风格、命名约定在项目中保持一致
- **测试驱动**：核心功能要有单元测试，重要修复要有回归测试

### 文档原则
- **拒绝生成文档**：除非用户明确要求，不要生成 README、API 文档等
- **代码即文档**：通过清晰的命名和结构表达意图
- **注释只解释为什么**：不要解释代码做了什么（代码本身应清晰）

## 技术栈说明

### 后端 (Python)
- **框架**: FastAPI (异步 Web 框架)
- **服务器**: Uvicorn (ASGI 服务器)
- **数据库**: ChromaDB (向量数据库，用于事件缓存)
- **AI 服务**: OpenAI API, Anthropic API
- **文本处理**: Sentence Transformers (文本嵌入)
- **数据验证**: Pydantic
- **地理服务**: Geopy
- **HTTP 客户端**: httpx, requests

### 前端 (TypeScript/React)
- **框架**: React 18 + TypeScript
- **构建工具**: Vite
- **样式**: Tailwind CSS
- **HTTP 客户端**: Axios
- **图标**: Lucide React

### 部署
- **Web 服务器**: Nginx (反向代理)
- **SSL**: Let's Encrypt (Certbot)
- **进程管理**: systemd
- **CI/CD**: GitHub Actions

## 前后端接口

### 主要 API 端点

#### 1. 聊天接口
```
POST /api/chat
Request: ChatRequest {
  message: string,
  conversation_history: ChatMessage[],
  llm_provider?: string,
  location?: LocationCoordinates
}
Response: ChatResponse {
  message: string,
  recommendations: RecommendationItem[],
  llm_provider_used: string,
  cache_used: bool,
  cache_age_hours?: float
}
```

#### 2. 地理编码接口
```
POST /api/geocode
Request: { input_text: string }
Response: {
  success: boolean,
  coordinates: LocationCoordinates | null,
  error_message: string | null
}
```

#### 3. 缓存清理接口
```
POST /api/cache/cleanup
Response: {
  success: boolean,
  message: string,
  stats: object
}
```

#### 4. 缓存统计接口
```
GET /api/cache/stats
Response: {
  success: boolean,
  stats: object
}
```

#### 5. 健康检查
```
GET /health
Response: {
  status: string,
  version: string,
  features: string[]
}
```

#### 6. 系统统计
```
GET /stats
Response: {
  status: string,
  cache_stats: object,
  features: string[]
}
```

### 前端 API 方法
- `chat()` - 发送聊天请求
- `geocodeLocation()` - 地理编码
- `getStats()` - 获取系统统计
- `healthCheck()` - 健康检查

## 开发规范
- 使用 TypeScript 进行类型检查
- 遵循 React Hooks 模式
- 使用 async/await 处理异步操作
- 错误处理要完善
- 日志记录要详细
